<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ABS Crackers World</title>
    <meta name="theme-color" content="#0ea5e9" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <!-- Modern Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Nunito:wght@400;700&family=Poppins:wght@400;600&display=swap"
      rel="stylesheet"
    />

    <style>
      :root {
        --bg: #0b1220;
        --card: #0f172a;
        --muted: #94a3b8;
        --text: #e2e8f0;
        --accent: #0ea5e9;
        --ok: #22c55e;
        --bad: #ef4444;
      }
      * {
        box-sizing: border-box;
      }
      html,
      body {
        margin: 0;
        height: 100%;
        font-family: "Poppins", "Inter", "Nunito", system-ui, -apple-system,
          Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
        background: linear-gradient(180deg, #0a0f1c, #0b1220 40%);
        color: var(--text);
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
      h1,
      h2,
      h3 {
        font-family: "Poppins", sans-serif;
        font-weight: 600;
      }

      a {
        color: inherit;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 12px;
      }
      header {
        position: sticky;
        top: 0;
        z-index: 50;
        background: rgba(15, 23, 42, 0.8);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid #1f2937;
      }
      .topbar {
        display: flex;
        gap: 12px;
        align-items: center;
        justify-content: space-between;
        padding: 10px 12px;
      }
      .brand {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .brand h1 {
        font-size: 18px;
        margin: 0;
        font-weight: 700;
        letter-spacing: 0.2px;
      }
      .badge {
        font-size: 11px;
        padding: 3px 8px;
        border: 1px solid #1f2937;
        border-radius: 999px;
        color: var(--muted);
      }
      .filters {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 8px;
      }
      @media (min-width: 720px) {
        .filters {
          grid-template-columns: 220px 1fr 1fr;
        }
      }
      select,
      input[type="search"] {
        width: 100%;
        padding: 10px 12px;
        border-radius: 10px;
        border: 1px solid #1f2937;
        background: #0b1220;
        color: var(--text);
      }
      .grid {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 10px;
      }
      @media (min-width: 720px) {
        .grid {
          grid-template-columns: repeat(3, minmax(0, 1fr));
        }
      }
      @media (min-width: 1024px) {
        .grid {
          grid-template-columns: repeat(4, minmax(0, 1fr));
        }
      }
      .card {
        background: linear-gradient(180deg, #0f172a, #0b1220);
        border: 1px solid #1f2937;
        border-radius: 16px;
        padding: 12px;
        display: flex;
        flex-direction: column;
        gap: 8px;
        min-height: 160px;
      }
      .title {
        font-weight: 600;
        font-size: 14px;
        line-height: 1.2;
      }
      .muted {
        color: var(--muted);
        font-size: 11px;
      }
      .row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
      }
      .pill {
        font-size: 11px;
        padding: 2px 8px;
        border-radius: 999px;
        border: 1px dashed #1f2937;
        color: #93c5fd;
      }
      .price {
        display: flex;
        align-items: baseline;
        gap: 8px;
      }
      .price .mrp {
        text-decoration: line-through;
        color: #64748b;
        font-size: 12px;
      }
      .price .sale {
        font-size: 16px;
        font-weight: 700;
        color: #e0f2fe;
      }
      .qty {
        display: flex;
        gap: 6px;
        align-items: center;
      }
      .qty button {
        width: 28px;
        height: 28px;
        border: 1px solid #1f2937;
        background: #0a0f1c;
        color: var(--text);
        border-radius: 8px;
      }
      .qty input {
        width: 40px;
        text-align: center;
        padding: 6px;
        border: 1px solid #1f2937;
        border-radius: 8px;
        background: #0a0f1c;
        color: var(--text);
      }
      .btn {
        appearance: none;
        border: 0;
        border-radius: 10px;
        padding: 10px 12px;
        font-weight: 600;
        cursor: pointer;
      }
      .btn-primary {
        background: linear-gradient(90deg, #8b5cf6, #ec4899);

        color: white;
        border: 1px solid #075985;
      }
      .btn-ghost {
        background: transparent;
        border: 1px dashed #1f2937;
        color: var(--text);
      }
      .layout {
        display: grid;
        grid-template-columns: 1fr;
        gap: 12px;
      }
      @media (min-width: 1024px) {
        .layout {
          grid-template-columns: 1fr 360px;
        }
      }
      .cart {
        position: sticky;
        top: 60px;
        align-self: start;
        background: linear-gradient(180deg, #0f172a, #0b1220);
        border: 1px solid #1f2937;
        border-radius: 16px;
        padding: 12px;
      }
      .cart h3 {
        margin: 0 0 8px 0;
      }
      .cart-list {
        display: flex;
        flex-direction: column;
        gap: 8px;
        max-height: 50vh;
        overflow: auto;
        padding-right: 4px;
      }
      .cart-item {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 4px;
        padding: 8px;
        border: 1px solid #1f2937;
        border-radius: 12px;
        background: #0a0f1c;
      }
      .cart-item .name {
        font-size: 13px;
        font-weight: 600;
      }
      .cart-item .meta {
        font-size: 12px;
        color: var(--muted);
      }
      .cart-item .amt {
        font-weight: 700;
      }
      .summary {
        display: grid;
        gap: 6px;
        margin-top: 8px;
      }
      .summary .row {
        font-size: 14px;
      }
      .divider {
        height: 1px;
        background: #1f2937;
        margin: 8px 0;
      }
      footer {
        padding: 40px 0;
        color: #94a3b8;
        text-align: center;
      }
      .empty {
        border: 1px dashed #1f2937;
        border-radius: 12px;
        padding: 20px;
        text-align: center;
        color: var(--muted);
      }
      .toast {
        position: fixed;
        bottom: 12px;
        left: 50%;
        transform: translateX(-50%);
        background: #0a0f1c;
        border: 1px solid #1f2937;
        color: var(--text);
        padding: 10px 14px;
        border-radius: 10px;
        display: none;
      }
      /* Flexbox for header */
      .container.topbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: relative;
      }

      .brand {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      /* Offer badge */
      .offer-badge {
        background: #38bdf8; /* Sky Blue */
        color: #fff;
        padding: 8px 14px;
        border-radius: 12px;
        font-size: 15px;
        font-weight: bold;
        text-align: center;
        box-shadow: 0 0 12px rgba(56, 189, 248, 0.7);
        animation: pulse 1.5s infinite, firework 2s infinite;
      }

      /* Glow animation */
      @keyframes pulse {
        0% {
          box-shadow: 0 0 6px rgba(56, 189, 248, 0.6);
        }
        50% {
          box-shadow: 0 0 20px rgba(56, 189, 248, 1);
        }
        100% {
          box-shadow: 0 0 6px rgba(56, 189, 248, 0.6);
        }
      }

      /* Crackers wiggle */
      @keyframes firework {
        0% {
          transform: scale(1) rotate(0deg);
        }
        25% {
          transform: scale(1.1) rotate(-5deg);
        }
        50% {
          transform: scale(1.2) rotate(5deg);
        }
        75% {
          transform: scale(1.1) rotate(-3deg);
        }
        100% {
          transform: scale(1) rotate(0deg);
        }
      }

      /* 📱 Mobile Fix: Move badge below logo */
      @media (max-width: 600px) {
        .container.topbar {
          flex-direction: column;
          align-items: center;
          gap: 8px;
        }
      }
      /* Customer form styling */
      .customer-input {
        width: 100%;
        padding: 8px 10px;
        border-radius: 8px;
        border: 1px solid #1f2937;
        background: #0a0f1c;
        color: #e2e8f0;
        transition: border 0.2s, box-shadow 0.2s;
      }

      .customer-input:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 6px rgba(14, 165, 233, 0.6);
      }

      .error {
        color: var(--bad);
        font-size: 12px;
        margin-top: 2px;
        display: none;
      }

      .toast-success {
        position: fixed;
        top: 30%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: #16a34a; /* green */
        color: #fff;
        font-size: 18px;
        font-weight: bold;
        padding: 16px 24px;
        border-radius: 12px;
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
        z-index: 1000;
        display: none;
        animation: fadeInOut 3s ease forwards;
      }

      @keyframes fadeInOut {
        0% {
          opacity: 0;
          transform: translate(-50%, -60%);
        }
        10% {
          opacity: 1;
          transform: translate(-50%, -50%);
        }
        90% {
          opacity: 1;
        }
        100% {
          opacity: 0;
          transform: translate(-50%, -40%);
        }
      }
      .summary .payable {
        background: #1e3a8a; /* blue background */
        color: #fff;
        padding: 8px 10px;
        border-radius: 8px;
        font-size: 16px;
        font-weight: bold;
      }
      .cart-icon {
        position: fixed;
        top: 12px;
        right: 12px;
        background: linear-gradient(90deg, #8b5cf6, #ec4899);

        color: white;
        font-size: 20px;
        font-weight: bold;
        width: 42px;
        height: 42px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        cursor: pointer;
        z-index: 1000;
      }

      .badge-count {
        position: absolute;
        top: -4px;
        right: -4px;
        background: #ef4444;
        color: white;
        font-size: 12px;
        padding: 2px 6px;
        border-radius: 999px;
      }

      .back-to-top {
        position: fixed;
        bottom: 80px;
        right: 16px;
        width: 42px;
        height: 42px;
        border-radius: 50%;
        background: linear-gradient(90deg, #8b5cf6, #ec4899);

        color: white;
        font-size: 20px;
        font-weight: bold;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        opacity: 0.3; /* 👈 very light by default */
        transition: opacity 0.3s ease;
        z-index: 999;
      }
      .back-to-top:hover {
        opacity: 1; /* 👈 fully visible when hovered */
      }
      .back-to-top.visible {
        opacity: 0.9; /* 👈 visible when scrolled down */
      }

      @keyframes slideNote {
        0% {
          transform: translateX(100%);
        }
        50% {
          transform: translateX(0);
        }
        100% {
          transform: translateX(-100%);
        }
      }
      #whatsappBtn {
        position: fixed;
        bottom: 80px; /* 👈 keeps it above the back-to-top button */
        right: 16px;
        z-index: 9999;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #25d366;
        border-radius: 50%;
        width: 56px;
        height: 56px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.25);
        transition: transform 0.2s ease-in-out;
      }
      #whatsappBtn img {
        width: 32px;
        height: 32px;
      }
      #whatsappBtn:hover {
        transform: scale(1.1);
      }

      /* Mobile Optimization */
      @media (max-width: 600px) {
        #whatsappBtn {
          width: 48px;
          height: 48px;
          bottom: 127px; /* still above back-to-top */
          right: 12px;
        }
        #whatsappBtn img {
          width: 26px;
          height: 26px;
        }
      }
      /* 📱 Mobile Fix for logo + offer badge */
      @media (max-width: 600px) {
        .container.topbar {
          flex-direction: column;
          align-items: flex-start; /* keep logo & text left */
          gap: 8px;
        }

        .offer-badge {
          align-self: center; /* offer badge stays centered below */
        }
      }
      /* Firework sparkle effect */
      @keyframes sparkle {
        0%,
        100% {
          text-shadow: 0 0 6px #facc15, 0 0 12px #f97316, 0 0 18px #ef4444;
        }
        50% {
          text-shadow: 0 0 12px #fde047, 0 0 20px #fb923c, 0 0 30px #f87171;
        }
      }

      .brand h1 {
        font-size: 20px;
        margin: 0;
        font-weight: 800;
        letter-spacing: 1px;
        white-space: nowrap;

        background: linear-gradient(90deg, #facc15, #f97316, #ef4444);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;

        /* Glow + animation */
        text-shadow: 0 0 6px rgba(250, 204, 21, 0.8);
        animation: sparkle 2s infinite alternate ease-in-out;
      }
      /* Spinner for Place Order button */
      .btn-loading {
        position: relative;
        pointer-events: none;
        opacity: 0.8;
      }

      .btn-loading::after {
        content: "";
        position: absolute;
        right: 12px;
        top: 50%;
        width: 16px;
        height: 16px;
        margin-top: -8px;
        border: 2px solid #fff;
        border-top-color: transparent;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
      /* 🆕 Success Modal */
      .success-modal {
        display: none; /* hidden by default */
        position: fixed;
        z-index: 9999;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.4);
        justify-content: center;
        align-items: center;
      }

      .success-modal-content {
        background: rgba(255, 255, 255, 0.9); /* glassy white */
        backdrop-filter: blur(8px); /* glass effect */
        color: #0f5132; /* deep festive green */
        padding: 25px 40px;
        border-radius: 16px;
        font-size: 18px;
        text-align: center;
        font-weight: 600;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25);
        border: 2px solid #22c55e;
        animation: popIn 0.5s ease, glowPulse 2s infinite;
        position: relative;
        overflow: hidden;
      }

      /* Entry animation */
      @keyframes popIn {
        from {
          transform: scale(0.8) translateY(30px);
          opacity: 0;
        }
        to {
          transform: scale(1) translateY(0);
          opacity: 1;
        }
      }

      /* Glow pulse like fireworks */
      @keyframes glowPulse {
        0% {
          box-shadow: 0 0 8px #22c55e, 0 0 20px #22c55e;
        }
        50% {
          box-shadow: 0 0 20px #4ade80, 0 0 40px #22c55e;
        }
        100% {
          box-shadow: 0 0 8px #22c55e, 0 0 20px #22c55e;
        }
      }

      @keyframes fadeInScale {
        from {
          transform: scale(0.9);
          opacity: 0;
        }
        to {
          transform: scale(1);
          opacity: 1;
        }
      }
      .toast-add {
        position: fixed;
        bottom: 20%; /* ✅ move up from bottom (adjust % as you like) */
        left: 50%;
        transform: translateX(-50%); /* center horizontally */
        background: linear-gradient(270deg, #22c55e, #3b82f6, #ec4899, #facc15);
        background-size: 800% 800%;
        color: #fff;
        font-size: 16px;
        font-weight: bold;
        padding: 10px 24px; /* smaller padding for single-line look */
        border-radius: 12px;
        white-space: nowrap; /* ✅ keep text on one line */
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.5);
        z-index: 2000;
        display: none;
        animation: fadeInOut 3s ease forwards, gradientMove 5s ease infinite;
      }

      @keyframes gradientMove {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }
      .tag {
        position: absolute;
        top: 10px;
        left: 10px;
        padding: 4px 10px;
        border-radius: 8px;
        font-size: 12px;
        font-weight: bold;
        color: #fff;
      }
      .tag-limited {
        background: #facc15;
        color: #0f172a;
      }
      .tag-out {
        background: #ef4444;
      }
      .tag-fast {
        background: #22c55e;
      }
      .video-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        justify-content: center;
        align-items: center;
        z-index: 9999;
      }
      .video-content {
        position: relative;
        width: 90%;
        max-width: 400px;
        background: #000;
        border-radius: 12px;
        /* overflow: hidden;  <-- remove or change */
        overflow: visible; /* ✅ allow the X to be clickable */
      }

      .video-content video {
        width: 100%;
        height: auto;
      }
      .video-content .close {
        position: absolute;
        top: 8px;
        right: 12px;
        font-size: 28px;
        color: #fff;
        cursor: pointer;
        z-index: 10000; /* make sure it's above the video */
      }

      .video-btn {
        border: none;
        background: rgba(0, 0, 0, 0.6);
        color: white;
        border-radius: 50%;
        width: 32px;
        height: 32px;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
      }
      .video-btn {
        border: none;
        background: radial-gradient(circle at 30% 30%, #d500f9, #ff4081);

        color: white;
        border-radius: 50%;
        width: 48px; /* bigger & easier to tap */
        height: 48px;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        box-shadow: 0 0 12px rgba(249, 212, 35, 0.6);
        /* animation: pulsePlay 1.8s infinite ease-in-out; */
        transition: transform 0.2s ease;
      }

      .video-btn:hover {
        transform: scale(1.15);
      }

      /* 🔄 gentle pulse to attract attention */
      @keyframes pulsePlay {
        0% {
          transform: scale(1);
          box-shadow: 0 0 8px rgba(249, 212, 35, 0.6);
        }
        50% {
          transform: scale(1.15);
          box-shadow: 0 0 20px rgba(255, 78, 80, 0.9);
        }
        100% {
          transform: scale(1);
          box-shadow: 0 0 8px rgba(249, 212, 35, 0.6);
        }
      }

      /* Optional: larger play symbol inside */
      .video-btn::before {
        content: "▶";
        font-size: 20px;
        margin-left: 2px; /* center the triangle optically */
      }
      .video-btn {
        border: none;
        background: #ff0000; /* YouTube red */
        color: white; /* white play icon */
        border-radius: 50%;
        width: 48px;
        height: 48px;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        box-shadow: 0 0 12px rgba(255, 0, 0, 0.6);
        animation: pulsePlay 1.8s infinite ease-in-out;
        transition: transform 0.2s ease;
      }

      .video-btn:hover {
        transform: scale(1.15);
      }

      @keyframes pulsePlay {
        0% {
          transform: scale(1);
          box-shadow: 0 0 8px rgba(255, 0, 0, 0.6);
        }
        50% {
          transform: scale(1.15);
          box-shadow: 0 0 20px rgba(255, 0, 0, 0.9);
        }
        100% {
          transform: scale(1);
          box-shadow: 0 0 8px rgba(255, 0, 0, 0.6);
        }
      }

      .video-btn::before {
        content: "▶";
        font-size: 20px;
        margin-left: 2px; /* visually center the triangle */
      }
      /* ===== Modern Video Modal ===== */

      .video-modal {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.6); /* softer dark overlay */
        backdrop-filter: blur(8px); /* glassy blur */
        justify-content: center;
        align-items: center;
        z-index: 9999;
        padding: 5vh 2vw; /* top/bottom breathing space */
      }

      .video-content {
        position: relative;
        width: 90%;
        max-width: 640px;
        max-height: 80vh;
        background: #000;
        border-radius: 20px;
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.4);
        overflow: hidden;
        transform: scale(0.9);
        opacity: 0;
        animation: popIn 0.35s ease forwards; /* smooth entrance */
      }

      @keyframes popIn {
        to {
          transform: scale(1);
          opacity: 1;
        }
      }

      .video-content video {
        width: 100%;
        height: auto;
        display: block;
        border-radius: 20px;
      }

      .video-content .close {
        position: absolute;
        top: 2px;
        right: 5px;
        width: 19px;
        height: 36px;
        line-height: 36px;
        background: #fff;
        border-radius: 50%;
        color: #000;
        font-size: 29px;
        cursor: pointer;
        backdrop-filter: blur(4px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        transition: background 0.2s;
      }
      .video-content .close:hover {
        background: rgba(255, 255, 255, 0.3);
      }
      .offer-badge {
        /* animated gradient background like .toast-add */
        background: linear-gradient(270deg, #22c55e, #3b82f6, #ec4899, #facc15);
        background-size: 800% 800%;

        color: #fff;
        padding: 8px 14px;
        border-radius: 12px;
        font-size: 15px;
        font-weight: bold;
        text-align: center;
        box-shadow: 0 0 12px rgba(0, 0, 0, 0.4);

        /* reuse the gradientMove animation for smooth color shifting */
        animation: gradientMove 5s ease infinite, pulse 1.5s infinite;
      }

      /* keep your existing keyframes or ensure these are present */
      @keyframes gradientMove {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }

      @keyframes pulse {
        0% {
          box-shadow: 0 0 6px rgba(255, 255, 255, 0.6);
        }
        50% {
          box-shadow: 0 0 20px rgba(255, 255, 255, 0.9);
        }
        100% {
          box-shadow: 0 0 6px rgba(255, 255, 255, 0.6);
        }
      }
      /* Offer badge: animated gradient + pulse + dancing (firework) */
      .offer-badge {
        /* gradient background (same style as .toast-add) */
        background: linear-gradient(270deg, #22c55e, #3b82f6, #ec4899, #facc15);
        background-size: 800% 800%;
        /* fallback (keeps your old sky-blue when gradient unsupported) */
        background-color: #38bdf8;

        color: #fff;
        padding: 8px 14px;
        border-radius: 12px;
        font-size: 15px;
        font-weight: bold;
        text-align: center;

        /* subtle shadow */
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.35);

        /* combined animations: gradient move, soft pulse, and dance */
        animation: gradientMove 6s ease infinite, pulse 1.6s infinite,
          firework 2s infinite;

        transform-origin: center center;
        will-change: background-position, box-shadow, transform;
      }

      /* Smooth gradient shift (reused from .toast-add) */
      @keyframes gradientMove {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }

      /* Gentle glow pulse to attract attention */
      @keyframes pulse {
        0% {
          box-shadow: 0 6px 12px rgba(255, 255, 255, 0.06),
            0 0 6px rgba(255, 255, 255, 0.04);
        }
        50% {
          box-shadow: 0 10px 22px rgba(255, 255, 255, 0.1),
            0 0 20px rgba(255, 255, 255, 0.06);
        }
        100% {
          box-shadow: 0 6px 12px rgba(255, 255, 255, 0.06),
            0 0 6px rgba(255, 255, 255, 0.04);
        }
      }

      /* Dancing / wiggle animation you had earlier */
      @keyframes firework {
        0% {
          transform: scale(1) rotate(0deg);
        }
        25% {
          transform: scale(1.06) rotate(-4deg);
        }
        50% {
          transform: scale(1.08) rotate(4deg);
        }
        75% {
          transform: scale(1.06) rotate(-2deg);
        }
        100% {
          transform: scale(1) rotate(0deg);
        }
      }
      /* ===== Success Modal ===== */
      .success-modal {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(6px); /* soft glassy backdrop */
        justify-content: center;
        align-items: center;
        z-index: 9999;
        padding: 5vh 2vw;
      }

      /* Inner content with gradient + pulse + wiggle */
      .success-modal-content {
        background: linear-gradient(270deg, #22c55e, #3b82f6, #ec4899, #facc15);
        background-size: 800% 800%;
        color: #fff;
        padding: 24px 40px;
        border-radius: 16px;
        font-size: 20px;
        font-weight: bold;
        text-align: center;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);

        /* 🎉 combined animations: moving gradient, soft glow, dancing wiggle */
        animation: gradientMove 6s ease infinite, pulse 1.5s infinite,
          firework 2s infinite;

        transform-origin: center;
        will-change: background-position, box-shadow, transform;
      }

      /* --- reused keyframes --- */
      @keyframes gradientMove {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }

      @keyframes pulse {
        0% {
          box-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
        }
        50% {
          box-shadow: 0 0 20px rgba(255, 255, 255, 0.6);
        }
        100% {
          box-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
        }
      }

      @keyframes firework {
        0% {
          transform: scale(1) rotate(0deg);
        }
        25% {
          transform: scale(1.06) rotate(-4deg);
        }
        50% {
          transform: scale(1.08) rotate(4deg);
        }
        75% {
          transform: scale(1.06) rotate(-2deg);
        }
        100% {
          transform: scale(1) rotate(0deg);
        }
      }
      /* New limited-stock badge */
      .limited-badge {
        position: absolute;
        top: 8px;
        left: 8px;
        padding: 4px 12px;
        font-size: 13px;
        font-weight: 700;
        color: #0f172a;
        background: linear-gradient(45deg, #facc15, #f97316);
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.25);
        text-transform: uppercase;
        z-index: 3;
        animation: badgePulse 1.6s infinite;
      }

      @keyframes badgePulse {
        0% {
          transform: scale(1);
          box-shadow: 0 0 6px rgba(250, 204, 21, 0.5);
        }
        50% {
          transform: scale(1.1);
          box-shadow: 0 0 16px rgba(249, 115, 22, 0.7);
        }
        100% {
          transform: scale(1);
          box-shadow: 0 0 6px rgba(250, 204, 21, 0.5);
        }
      }
      .soldout-badge {
        position: absolute;
        top: 8px;
        left: 8px;
        padding: 4px 12px;
        font-size: 13px;
        font-weight: 700;
        color: #fff;
        background: linear-gradient(45deg, #ef4444, #dc2626); /* red shades */
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.25);
        text-transform: uppercase;
        z-index: 3;
        animation: badgePulse 1.6s infinite;
      }
      .soldout-disabled {
        opacity: 0.5;
        pointer-events: none; /* prevent clicks */
        cursor: not-allowed;
      }
      /* Modern category dropdown */
      #categoryFilter {
        appearance: none; /* hide default arrow */
        background: linear-gradient(90deg, #ff7e5f, #feb47b);
        color: #fff;
        font-size: 16px;
        font-weight: 600;
        padding: 10px 40px 10px 14px;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        transition: box-shadow 0.25s, transform 0.25s;
        position: relative;
      }

      /* add a custom arrow */
      #categoryFilter::after {
        content: "▼";
        position: absolute;
        right: 14px;
        top: 50%;
        transform: translateY(-50%);
        pointer-events: none;
        color: #fff;
        font-size: 12px;
      }

      /* hover / focus effects */
      #categoryFilter:hover,
      #categoryFilter:focus {
        box-shadow: 0 6px 18px rgba(255, 126, 95, 0.6);
        transform: translateY(-2px);
        outline: none;
      }

      /* dropdown list itself */
      #categoryFilter option {
        background: #1e293b; /* dark festive backdrop */
        color: #fff;
        padding: 8px;
      }
      /* Modern select with built-in arrow indicator */
      #categoryFilter {
        appearance: none; /* hide native arrow */
        background: linear-gradient(90deg, #8b5cf6, #ec4899);

        color: #fff;
        font-size: 16px;
        font-weight: 600;
        padding: 10px 40px 10px 16px; /* extra right padding for arrow */
        border: none;
        border-radius: 12px;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        position: relative;
        transition: box-shadow 0.25s, transform 0.25s;
      }

      /* custom arrow */
      #categoryFilter::after {
        content: "▾"; /* down-arrow glyph */
        position: absolute;
        right: 14px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 14px;
        color: #fff;
        pointer-events: none; /* let clicks pass through */
      }

      /* hover / focus effects */
      #categoryFilter:hover,
      #categoryFilter:focus {
        box-shadow: 0 0 0 3px rgba(255, 126, 95, 0.4);
        transform: translateY(-1px);
        outline: none;
      }

      /* style the dropdown list itself */
      #categoryFilter option {
        background: #1e293b; /* dark festive list */
        color: #fff;
        padding: 8px 12px;
      }
      /* Modern festive search box */
      #search {
        width: 189px; /* adjust as needed */
        padding: 10px 44px 10px 16px; /* space for icon on the right */
        font-size: 16px;
        color: #fff;
        background: rgba(255, 255, 255, 0.05); /* subtle translucent dark bg */
        border: 2px solid transparent;
        border-radius: 14px;
        backdrop-filter: blur(6px);
        outline: none;
        transition: border-color 0.25s, box-shadow 0.25s;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        caret-color: #fff;
      }

      /* Placeholder text color */
      #search::placeholder {
        color: rgba(255, 255, 255, 0.6);
      }

      /* glow on focus */
      #search:focus {
        border-color: #ff7e5f;
        box-shadow: 0 0 8px rgba(255, 126, 95, 0.6);
      }

      /* Optional: decorative search icon on right side */
      #search::after {
        content: "🔍"; /* choose any icon or emoji */
        position: absolute;
        right: 14px;
        top: 50%;
        transform: translateY(-50%);
        pointer-events: none;
      }
      /* container */
      .summary {
        background: rgba(255, 255, 255, 0.05);
        padding: 20px 24px;
        border-radius: 16px;
        max-width: 420px;
        margin: 30px auto;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.35);
        backdrop-filter: blur(6px);
      }

      /* each label + field block */
      .summary label {
        display: block;
        margin-bottom: 20px;
        font-weight: 600;
        color: #f1f5f9;
        font-size: 15px;
      }

      /* inputs and textarea */
      .customer-input {
        width: 100%;
        margin-top: 6px;
        padding: 10px 14px;
        border: 2px solid transparent;
        border-radius: 12px;
        background: rgba(255, 255, 255, 0.08);
        color: #fff;
        font-size: 15px;
        transition: border-color 0.25s, box-shadow 0.25s;
      }

      .customer-input::placeholder {
        color: rgba(255, 255, 255, 0.5);
      }

      /* focus state with warm glow */
      .customer-input:focus {
        outline: none;
        border-color: #3b82f6; /* choose a theme color */
        box-shadow: 0 0 8px rgba(59, 130, 246, 0.6);
      }

      /* textarea sizing */
      .summary textarea.customer-input {
        min-height: 80px;
        resize: vertical;
      }

      /* error text */
      .error {
        color: #f87171;
        font-size: 13px;
        margin-top: 4px;
        display: none; /* hide by default; show when needed */
      }

      /* optional: show when JS adds .show */
      .error.show {
        display: block;
      }
      .new-badge {
        position: absolute;
        top: 30px;
        left: 6px;
        padding: 4px 12px;
        font-size: 13px;
        font-weight: 700;
        color: #fff;
        background: linear-gradient(45deg, #3b82f6, #2563eb);
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.25);
        text-transform: uppercase;
        z-index: 3;
        /* animation: badgePulse 1.6s infinite; */
      }
      .mobile-nav .cart-btn {
        position: relative;
      }

      .mobile-nav .badge-count {
        position: absolute;
        top: -4px;
        right: 34px;
        background: #ef4444;
        color: white;
        font-size: 12px;
        padding: 2px 6px;
        border-radius: 999px;
      }

      /* 📱 Mobile Bottom Nav */
      .mobile-nav {
        display: none; /* hidden on desktop */
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background: #0f172a;
        border-top: 1px solid #1f2937;
        display: flex;
        justify-content: space-around;
        padding: 6px 0;
        z-index: 1000;
      }

      .mobile-nav button {
        flex: 1;
        background: none;
        border: none;
        color: #e2e8f0;
        font-size: 16px;
        font-weight: 600;
        text-align: center;
        padding: 6px 0;
      }

      .mobile-nav button span {
        font-size: 12px;
        display: block;
        margin-top: 2px;
      }

      @media (max-width: 720px) {
        .mobile-nav {
          display: flex;
        }
        body {
          padding-bottom: 60px;
        } /* space so content not hidden */
      }
      /* Hide by default */
      .mobile-nav {
        display: none;
      }

      /* Show only on small screens */
      @media (max-width: 720px) {
        .mobile-nav {
          display: flex;
        }
        body {
          padding-bottom: 60px; /* avoid content overlap */
        }
      }
      /* Hidden by default */
      .drawer {
        display: none;
        position: fixed;
        top: 0;
        right: 0;
        width: 80%;
        max-width: 320px;
        height: 100%;
        background: #0f172a;
        color: #fff;
        box-shadow: -4px 0 12px rgba(0, 0, 0, 0.5);
        z-index: 2000;
        transform: translateX(100%);
        transition: transform 0.3s ease-in-out;
      }

      /* When active, slide in */
      .drawer.show {
        display: block;
        transform: translateX(0);
      }

      .drawer-content {
        padding: 20px;
        position: relative;
      }

      .drawer-content h3 {
        margin-bottom: 12px;
        font-size: 18px;
        border-bottom: 1px solid #1f2937;
        padding-bottom: 8px;
      }

      .drawer-content ul {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .drawer-content ul li {
        padding: 10px;
        border-bottom: 1px solid #1f2937;
        cursor: pointer;
      }

      .drawer-content ul li:hover {
        background: #1e293b;
      }

      .close-btn {
        margin-top: 16px;
        width: 100%;
        padding: 10px;
        border: none;
        border-radius: 8px;
        background: #ef4444;
        color: #fff;
        font-weight: 600;
        cursor: pointer;
      }
      #categoryFilter {
        background: rgba(15, 23, 42, 0.7); /* brand purple */
        color: white;
        border: none;
        border-radius: 999px; /* pill shape */
        padding: 6px 14px;
        font-size: 14px;
        font-weight: 600;
        appearance: none; /* hide default arrow */
      }
      .btn-primary {
        background: linear-gradient(90deg, #8b5cf6, #ec4899); /* brand purple */
        color: white;
        border: none;
        border-radius: 8px;
        padding: 6px 10px;
        font-weight: 600;
        cursor: pointer;
      }
      :root {
        --brand-accent: #50791f;
        --brand-accent-hover: #3f6118;
        --brand-accent-bright: #6ba229;
        --brand-focus: rgba(80, 121, 31, 0.2);
        --btn-text: #ffffff;
      }

      :root {
        --brand-accent: linear-gradient(90deg, #8b5cf6, #ec4899);
        --brand-accent-hover: #c43c75;
        --brand-accent-bright: #ff5fa6;
        --btn-text: #ffffff;
      }
      .drawer-close {
        position: absolute;
        top: 12px;
        right: 16px;
        font-size: 24px;
        font-weight: bold;
        color: #fff;
        cursor: pointer;
        z-index: 10;
      }
      .drawer-close:hover {
        color: #ef4444;
      }
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"
      integrity="sha512-/F1OeG0cJ4c9bYkG5oB12tYt7cO2k5gKQx2i6C2zq7bQ9QttC5+n7m9GJm9kQxHk6qL1b0D5V6lJg3QfL7iVwA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
  </head>
  <body>
    <header>
      <div class="container topbar">
        <div class="brand">
          <img
            src="https://i.postimg.cc/9Fj7rpxZ/abs-logo.jpg"
            alt="ABS Logo"
            style="
              height: 50px;
              width: 50px;
              border-radius: 50%;
              object-fit: cover;
              margin-right: 8px;
            "
          />

          <h1>ABS Crackers World</h1>
        </div>

        <!-- Offer Badge -->
        <div class="offer-badge">
          🎆 90% OFFER 🎆<br />
          <small>Min Order ₹3500</small><br />
          <!--<span style="color: #f97316; font-weight: bold; font-size: 13px">
            🚚 Free Delivery
          </span> -->
        </div>
      </div>

      <div class="container" style="padding-bottom: 12px">
        <div class="filters">
          <select id="categoryFilter"></select>
          <input id="search" type="search" placeholder="Search Crackers…" />
        </div>

        <!-- Customer Note -->
        <div style="margin-top: 6px; overflow: hidden; white-space: nowrap">
          <span
            style="
              display: inline-block;
              font-size: 12px;
              font-style: italic;
              color: #facc15; /* golden-yellow accent */
              animation: slideNote 20s ease-in-out infinite;
            "
          >
            <!-- The Product Image is only for your reference, the packing and brand
            may change -->
            🎇 Vanakkam Makkale! New Arrival Added! | ⚠️ Price has been
            Increased due to high demand | The Product Image is only for your
            reference, the packing and brand may change
          </span>
        </div>
      </div>

      <div class="cart-icon" onclick="scrollToCart()">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="22"
          height="22"
          viewBox="0 0 24 24"
          fill="none"
          stroke="white"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <circle cx="9" cy="21" r="1"></circle>
          <circle cx="20" cy="21" r="1"></circle>
          <path
            d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"
          ></path>
        </svg>
        <span id="cartCount" class="badge-count">0</span>
      </div>
    </header>

    <main class="container layout">
      <section>
        <div id="productGrid" class="grid"></div>
        <div id="emptyState" class="empty" style="display: none">
          No items match your search.
        </div>
      </section>

      <aside class="cart" aria-live="polite">
        <h3>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            style="vertical-align: middle; margin-right: 6px"
          >
            <circle cx="9" cy="21" r="1" />
            <circle cx="20" cy="21" r="1" />
            <path
              d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"
            />
          </svg>
          Your Cart
        </h3>

        <div id="cartList" class="cart-list"></div>
        <div class="divider"></div>
        <div class="summary">
          <div class="row">
            <span>Items</span><strong id="sumItems">0</strong>
          </div>
          <div class="row">
            <span>MRP Total</span><strong id="sumMrp">₹0</strong>
          </div>
          <div class="row payable">
            <span>Payable Amount</span><strong id="sumSale">₹0</strong>
          </div>
          <div class="row">
            <span>You Save</span
            ><strong id="sumSave" style="color: var(--ok)">₹0</strong>
          </div>
        </div>

        <div class="divider"></div>
        <div class="summary">
          <label>
            Name:
            <input
              id="custName"
              type="text"
              class="customer-input"
              placeholder="Enter your name"
            />
            <div id="errName" class="error">Name is required</div>
          </label>
          <label>
            Mobile:
            <input
              id="custPhone"
              type="text"
              class="customer-input"
              placeholder="Enter your mobile"
            />
            <div id="errPhone" class="error">
              Enter a valid 10-digit mobile number
            </div>
          </label>
          <label>
            Address:
            <textarea
              id="custAddress"
              class="customer-input"
              placeholder="Enter your address"
            ></textarea>
            <div id="errAddress" class="error">Address is required</div>
          </label>
        </div>

        <!-- 🆕 Success Modal -->
        <div id="successModal" class="success-modal">
          <div class="success-modal-content">
            <!-- <span style="font-size: 22px">🎇</span> -->
            <p id="successMessage" style="margin: 0">
              Order placed successfully! Invoice downloaded.
            </p>
          </div>
        </div>

        <div class="divider"></div>
        <div class="row" style="gap: 8px">
          <button id="clearCart" class="btn btn-ghost" title="Remove all">
            Clear
          </button>
          <button id="placeOrder" class="btn btn-primary" style="flex: 1">
            Place Order
          </button>
        </div>
      </aside>
    </main>

    <footer>
      <div class="container">
        © 2025 ABS Crackers World • Sivakasi • Call: 80720 98251 / 95971 89599 /
        82487 10751
      </div>
    </footer>

    <div id="toast" class="toast"></div>
    <!-- ✅ new success popup -->
    <div id="successPopup" class="toast-success"></div>
    <!-- ✅ Back to Top Button -->
    <div id="backToTop" class="back-to-top" onclick="scrollToTop()">↑</div>
    <!-- ✅ Floating WhatsApp Button -->
    <a
      href="https://wa.me/918072098251?text=Hello%20ABS%20Crackers%20World!%20I%20would%20like%20to%20know%20more%20about%20your%20products."
      target="_blank"
      id="whatsappBtn"
    >
      <img src="https://img.icons8.com/color/48/whatsapp.png" alt="WhatsApp" />
    </a>

    <!-- ✅ Video Modal -->
    <div id="videoModal" class="video-modal">
      <div class="video-content">
        <span class="close" onclick="closeVideo()">&times;</span>
        <video id="modalVideo" controls playsinline></video>
      </div>
    </div>

    <!-- ✅ jsPDF (no integrity attribute to avoid blocking) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf-font@1.0.0/noto-sans.js"></script>

    <!-- Firebase Setup -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
      import {
        getFirestore,
        collection,
        addDoc,
        serverTimestamp,
      } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyC47paJy6jtyR6IH8Wq1wddeEXxS26zQeU",
        authDomain: "abscrackersworld-5e2e8.firebaseapp.com",
        projectId: "abscrackersworld-5e2e8",
        storageBucket: "abscrackersworld-5e2e8.appspot.com", // ✅ FIXED
        messagingSenderId: "1045745449432",
        appId: "1:1045745449432:web:c807324227ec41afb85aad",
        measurementId: "G-Q6G22EPHS5",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      // Expose db globally so your other script (below) can use it
      window.db = db;
      window.addDoc = addDoc;
      window.collection = collection;
      window.serverTimestamp = serverTimestamp;
    </script>
    <script src="products.js"></script>

    <script>
      function openFilter() {
        const drawer = document.getElementById("filterDrawer");
        const list = document.getElementById("drawerCategories");
        list.innerHTML = "";

        // Pull categories from existing dropdown
        const sel = document.getElementById("categoryFilter");
        if (sel) {
          Array.from(sel.options).forEach((opt) => {
            if (opt.value !== "") {
              // skip "All Categories"
              const li = document.createElement("li");
              li.textContent = opt.value;
              li.onclick = () => {
                sel.value = opt.value; // set real filter
                sel.dispatchEvent(new Event("change")); // trigger re-render
                closeFilterDrawer();
              };
              list.appendChild(li);
            }
          });
        }

        drawer.classList.add("show");
      }

      function closeFilterDrawer() {
        document.getElementById("filterDrawer").classList.remove("show");
      }
      function openVideo(src) {
        const modal = document.getElementById("videoModal");
        const video = document.getElementById("modalVideo");
        video.src = src;
        modal.style.display = "flex";
        video.play();
      }

      function closeVideo() {
        const modal = document.getElementById("videoModal");
        const video = document.getElementById("modalVideo");
        video.pause();
        video.src = "";
        modal.style.display = "none";
      }
      document.addEventListener("DOMContentLoaded", () => {
        async function saveOrderToFirebase(name, phone, addr, amount, items) {
          try {
            const docRef = await window.addDoc(
              window.collection(window.db, "orders"),
              {
                name,
                phone,
                address: addr,
                amount,
                items,
                createdAt: window.serverTimestamp(),
              }
            );
            console.log("✅ Order saved with ID:", docRef.id);
          } catch (e) {
            console.error("❌ Error saving order:", e);
            throw e; // rethrow so Place Order catches it
          }
        }

        const PRODUCT_VIDEOS = {
          120: "Videos/apple.mp4",
          126: "Videos/strawberry-fountain.mp4",
          127: "Videos/pumpkin-fountain.mp4",
          128: "Videos/pineapple.mp4",
        };
        // NEW / LIMITED lists (share with addBadges)
        const NEW_PRODUCTS = [
          "STRAWBERRY FOUNTAIN",
          "ORANGE FOUNTAIN",
          "PINEAPPLE FOUNTAIN",
          "APPLE - MIX",
          "PUMPKIN FOUNTAIN",
          // add more exact product names here
        ];

        const LIMITED_PRODUCTS = [
          "STRAWBERRY FOUNTAIN",
          "ORANGE FOUNTAIN",
          "PINEAPPLE FOUNTAIN",
          "APPLE - MIX",
          "PUMPKIN FOUNTAIN",
          "BADA PEACOCK",
          "GUITAR",
          "HANUMAN KADA",

          // add more product names here
        ];

        // --- State ---
        const STORAGE_KEY = "abs_crackers_catalog_v18";
        const CART_KEY = "abs_crackers_cart_v1";

        const Catalog = {
          list: [],
          load() {
            try {
              const saved = localStorage.getItem(STORAGE_KEY);
              if (saved) {
                const parsed = JSON.parse(saved);
                if (Array.isArray(parsed) && parsed.length > 0) {
                  this.list = parsed;
                } else {
                  this.list = STARTER_ITEMS;
                  this.save();
                }
              } else {
                this.list = STARTER_ITEMS;
                this.save();
              }
            } catch (e) {
              console.error("Catalog load failed, using starter items:", e);
              this.list = STARTER_ITEMS;
              this.save();
            }
            this.list = this.list.map((it, idx) => ({
              id: it.id ?? idx + 1,
              ...it,
            }));
          },
          save() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(this.list));
          },
        };

        console.log("First item with image:", Catalog.list[0]);
        function toastAdd(message) {
          const el = document.createElement("div");
          el.className = "toast-add";
          el.textContent = "🎉 " + message;
          document.body.appendChild(el);
          el.style.display = "block";
          setTimeout(() => el.remove(), 3000);
        }

        const Cart = {
          items: {},
          load() {
            try {
              this.items = JSON.parse(localStorage.getItem(CART_KEY) || "{}");
              // cleanup invalid IDs
              for (const id of Object.keys(this.items)) {
                if (!Catalog.list.find((x) => x.id == id))
                  delete this.items[id];
              }
              this.save();
            } catch (e) {
              console.error("Cart load failed, resetting:", e);
              this.items = {};
              this.save();
            }
          },
          save() {
            localStorage.setItem(CART_KEY, JSON.stringify(this.items));
          },
          add(id, qty = 1) {
            this.items[id] = (this.items[id] || 0) + qty;
            this.save();
            renderCart();
            toastAdd("Added to Cart");
          },
          set(id, qty) {
            if (qty <= 0) delete this.items[id];
            else this.items[id] = qty;
            this.save();
            renderCart();
          },
          clear() {
            this.items = {};
            this.save();
            renderCart();
          },
        };

        // --- UI helpers ---
        const el = (sel) => document.querySelector(sel);
        const fmt = (n) => "₹" + (n || 0).toLocaleString("en-IN");
        const toast = (msg) => {
          const t = el("#toast");
          t.textContent = msg;
          t.style.display = "block";
          setTimeout(() => (t.style.display = "none"), 1400);
        };

        // --- Render Catalog ---
        function renderFilters() {
          const categories = Array.from(
            new Set(Catalog.list.map((x) => x.category))
          ).sort();
          const sel = el("#categoryFilter");
          sel.innerHTML =
            `<option value="">All Categories  </option>` +
            categories.map((c) => `<option>${c}</option>`).join("");
        }
        function filteredItems() {
          const q = el("#search").value.trim().toLowerCase();
          const cat = el("#categoryFilter").value;
          return Catalog.list.filter((it) => {
            const okCat = !cat || it.category === cat;
            const okQ = !q || it.name.toLowerCase().includes(q);
            return okCat && okQ;
          });
        }

        // function filteredItems() {
        //   const q = el("#search").value.trim().toLowerCase();
        //   const cat = el("#categoryFilter").value;

        //   // base, in the same order as Catalog.list
        //   const base = Catalog.list.filter((it) => {
        //     const okCat = !cat || it.category === cat;
        //     const okQ = !q || it.name.toLowerCase().includes(q);
        //     return okCat && okQ;
        //   });

        //   // only apply priority on default "All" view with no search
        //   const applyPriority = !cat && !q;
        //   if (!applyPriority) return base;

        //   const newSet = new Set(NEW_PRODUCTS.map((s) => s.toLowerCase()));
        //   const limitedSet = new Set(
        //     LIMITED_PRODUCTS.map((s) => s.toLowerCase())
        //   );

        //   const newItems = [],
        //     limitedItems = [],
        //     others = [];
        //   for (const it of base) {
        //     const name = (it.name || "").toLowerCase();
        //     if (newSet.has(name)) newItems.push(it);
        //     else if (limitedSet.has(name)) limitedItems.push(it);
        //     else others.push(it);
        //   }

        //   return [...newItems, ...limitedItems, ...others];
        // }

        function renderGrid() {
          const grid = el("#productGrid");
          const items = filteredItems();
          console.log("Render order:", items.map((it) => it.name).slice(0, 10));

          grid.innerHTML = items
            .map((it) => {
              const save = (it.mrp || 0) - (it.sale || 0);
              return `
            <div class="card" role="group" aria-label="${it.name}">

              <!-- Product Image (fixed square thumbnail) -->
              <div class="img-box" style="width:100%;height:150px;margin-bottom:8px;overflow:hidden;border-radius:12px;position:relative;">
                <img src="${it.img}" alt="${it.name}"
                     style="width:100%;height:100%;object-fit:cover;display:block;"/>
                     ${
                       PRODUCT_VIDEOS[it.id]
                         ? `<button class="video-btn" onclick="openVideo('${
                             PRODUCT_VIDEOS[it.id]
                           }')" 
                   style="position:absolute;bottom:8px;right:8px;">▶</button>`
                         : ""
                     }
              </div>

              <!-- Category & Unit -->
              <div class="row">
                <div class="pill">${it.category}</div>
                <div class="muted">${it.unit || ""}</div>
              </div>

              <!-- Product Title -->
              <div class="title">${it.name}</div>

              <!-- Price & Savings -->
              <div class="row">
                <div class="price">
                  <span class="mrp">${fmt(it.mrp)}</span>
                  <span class="sale">${fmt(it.sale)}</span>
                </div>
                <div class="muted">Save ${fmt(save)}</div>
              </div>

              <!-- Quantity & Add to Cart -->
              <div class="row" style="margin-top:auto;gap:8px">
                <div class="qty">
                  <button aria-label="decrease" onclick="chgQty(${
                    it.id
                  },-1)">−</button>
                  <input id="q_${it.id}" type="number" min="1" value="1" />
                  <button aria-label="increase" onclick="chgQty(${
                    it.id
                  },1)">+</button>
                </div>
                <button class="btn btn-primary" style="flex:1" onclick="addToCart(${
                  it.id
                })">Add</button>
              </div>

            </div>`;
            })
            .join("");

          // Empty state toggle
          el("#emptyState").style.display = items.length ? "none" : "block";
          addBadges();
        }

        function chgQty(id, delta) {
          const inp = el("#q_" + id);
          let v = parseInt(inp.value || "1", 10);
          v = Math.max(1, v + delta);
          inp.value = v;
        }
        function addToCart(id) {
          const q = parseInt(el("#q_" + id)?.value || "1", 10);
          Cart.add(id, q);
        }

        function scrollToCart() {
          document
            .querySelector(".cart")
            ?.scrollIntoView({ behavior: "smooth" });
        }
        window.scrollToCart = scrollToCart; // ✅ expose globally

        // Update cart count bubble whenever cart changes
        function updateCartCount() {
          let sum = 0;
          for (const qty of Object.values(Cart.items)) sum += qty;
          el("#cartCount").textContent = sum;
          el("#cartCount").style.display = sum > 0 ? "block" : "none";

          const bottomBadge = document.getElementById("cartCountBottom");
          if (bottomBadge) {
            bottomBadge.textContent = sum;
            bottomBadge.style.display = sum > 0 ? "block" : "none";
          }
        }
        function scrollToTop() {
          window.scrollTo({ top: 0, behavior: "smooth" });
        }
        window.scrollToTop = scrollToTop; // expose for onclick

        // show/hide button while scrolling
        const backToTopBtn = document.getElementById("backToTop");
        window.addEventListener("scroll", () => {
          if (window.scrollY > 300) {
            backToTopBtn.classList.add("visible");
          } else {
            backToTopBtn.classList.remove("visible");
          }
        });

        // --- Render Cart ---
        function renderCart() {
          const list = el("#cartList");
          const lines = [];
          let sumItems = 0,
            mrp = 0,
            sale = 0;
          for (const [id, qty] of Object.entries(Cart.items)) {
            const it = Catalog.list.find((x) => x.id == id);
            if (!it) continue;
            const lineMrp = (it.mrp || 0) * qty;
            const lineSale = (it.sale || 0) * qty;
            sumItems += qty;
            mrp += lineMrp;
            sale += lineSale;
            lines.push(`
              <div class="cart-item">
                <div>
                  <div class="name">${it.name}</div>
                  <div class="meta">${it.unit || ""} • ${it.category}</div>
                  <div class="meta">${qty} × ${fmt(
              it.sale
            )} <span style="margin-left:6px">(MRP ${fmt(it.mrp)})</span></div>
                </div>
                <div style="text-align:right">
                  <div class="amt">${fmt(lineSale)}</div>
                  <div class="muted">Save ${fmt(lineMrp - lineSale)}</div>
                  <div class="qty" style="margin-top:6px;justify-content:flex-end">
                    <button onclick="Cart.set(${id}, (Cart.items[${id}]||0)-1)">−</button>
                    <input type="number" min="0" value="${qty}" onchange="Cart.set(${id}, parseInt(this.value||'0',10))"/>
                    <button onclick="Cart.set(${id}, (Cart.items[${id}]||0)+1)">+</button>
                  </div>
                </div>
              </div>`);
          }
          list.innerHTML =
            lines.join("") || `<div class="empty">Your cart is empty.</div>`;
          el("#sumItems").textContent = sumItems;
          el("#sumMrp").textContent = fmt(mrp);
          el("#sumSale").textContent = fmt(sale);
          el("#sumSave").textContent = fmt(mrp - sale);
          updateCartCount();
        }

        // --- WhatsApp Order ---
        function buildOrderText() {
          const lines = [];
          lines.push("*ABS Crackers Order*", "");
          for (const [id, qty] of Object.entries(Cart.items)) {
            const it = Catalog.list.find((x) => x.id == id);
            if (!it) continue;
            lines.push(
              `• ${it.name} (${it.unit}) — Qty ${qty} — ${fmt(it.sale)} each`
            );
          }
          lines.push("");
          lines.push(`MRP Total: ${el("#sumMrp").textContent}`);
          lines.push(`Discount Total: ${el("#sumSale").textContent}`);
          lines.push(`You Save: ${el("#sumSave").textContent}`);
          lines.push("");
          lines.push("Customer Name: ____");
          lines.push("Delivery/Pickup: ____");
          lines.push("Address/Notes: ____");
          return lines.join("\n");
        }
        function openWhatsApp() {
          const number = "918111087914";
          const text = encodeURIComponent(buildOrderText());
          window.open(`https://wa.me/${number}?text=${text}`, "_blank");
        }

        function showSuccess(msg) {
          const box = el("#successPopup");
          box.textContent = msg;
          box.style.display = "block";
          setTimeout(() => (box.style.display = "none"), 3000);
        }

        // --- PDF Generation ---

        // final

        async function downloadOrderPdf() {
          const { jsPDF } = window.jspdf;
          const doc = new jsPDF();

          // --- Load ABS Logo ---
          const logo = new Image();
          logo.crossOrigin = "anonymous";
          logo.src = "https://i.postimg.cc/9Fj7rpxZ/abs-logo.jpg";
          await new Promise((resolve) => {
            logo.onload = resolve;
          });

          // --- Load God Image ---
          const godImg = new Image();
          godImg.crossOrigin = "anonymous";
          godImg.src = "https://i.postimg.cc/MGmbtLv7/abs-god.webp";
          await new Promise((resolve) => {
            godImg.onload = resolve;
          });

          // --- Place Logo (left corner) ---
          doc.addImage(logo, "JPEG", 14, 10, 30, 30);

          // --- Place God Image (right corner) ---
          doc.addImage(godImg, "WEBP", 165, 10, 30, 30);

          // --- Header Text (center-left) ---
          doc.setFontSize(16);
          doc.text("ABS Crackers World", 60, 20);
          doc.setFontSize(10);
          doc.text("5/288/33, Sivakasi - 626189", 60, 26);
          doc.text("Contact: +91 80720 98251 / 95971 89599", 60, 32);

          // --- Invoice Info (shifted lower, below god image) ---
          const invoiceNo = "INV-" + Date.now();
          doc.setFontSize(11);
          doc.text(`Invoice No: ${invoiceNo}`, 150, 48); // ⬅️ moved down
          doc.text(`Date: ${new Date().toLocaleDateString()}`, 150, 54); // ⬅️ moved down

          // --- Customer Details ---
          const name = document.getElementById("custName")?.value || "N/A";
          const phone = document.getElementById("custPhone")?.value || "N/A";
          const addr = document.getElementById("custAddress")?.value || "N/A";

          doc.setFontSize(12);
          doc.text("Bill To:", 14, 50);
          doc.text(name, 50, 50);
          doc.text("Mobile:", 14, 56);
          doc.text(phone, 50, 56);
          doc.text("Ship To:", 14, 66);
          doc.text(addr, 50, 66);

          // --- Table Data ---
          const rows = [];
          let idx = 1,
            subtotal = 0;
          for (const [id, qty] of Object.entries(Cart.items)) {
            const it = Catalog.list.find((x) => x.id == id);
            if (!it) continue;
            const lineTotal = (it.sale || 0) * qty;
            subtotal += lineTotal;

            const price = fmt(it.sale).replace("₹", "Rs. ");
            const total = fmt(lineTotal).replace("₹", "Rs. ");
            rows.push([idx++, it.name, qty, price, total]);
          }

          // --- AutoTable ---
          doc.autoTable({
            head: [["#", "Product", "Qty", "Price", "Total"]],
            body: rows,
            startY: 80,
            theme: "striped",
            headStyles: { fillColor: [0, 123, 255] },
            styles: { halign: "center" },
            columnStyles: {
              1: { halign: "left" },
              2: { halign: "center" },
              3: { halign: "right" },
              4: { halign: "right" },
            },
          });

          const finalY = doc.lastAutoTable.finalY + 10;

          // --- Total ---
          const subText = fmt(subtotal).replace("₹", "Rs. ");
          doc.setFontSize(14);
          doc.setLineWidth(0.5);
          doc.line(150, finalY - 4, 200, finalY - 4);
          doc.text(`Total: ${subText}`, 200, finalY + 4, { align: "right" });

          // --- Footer ---
          doc.setFontSize(12);
          doc.text("Thank you for your order!", 80, 290);

          // --- Save PDF ---
          doc.save(`Invoice_${invoiceNo}.pdf`);
        }
        // 🆕 Show success modal for 3-5 seconds
        function showSuccessModal(message) {
          const modal = document.getElementById("successModal");
          const msgBox = document.getElementById("successMessage");
          msgBox.textContent = message;

          modal.style.display = "flex";

          // Auto-close after 4s
          setTimeout(() => {
            modal.style.display = "none";
          }, 4000);
        }

        function validateCustomer() {
          let valid = true;

          const name = el("#custName").value.trim();
          const phone = el("#custPhone").value.trim();
          const addr = el("#custAddress").value.trim();

          // Reset errors
          ["errName", "errPhone", "errAddress"].forEach(
            (id) => (el("#" + id).style.display = "none")
          );

          if (!name) {
            el("#errName").style.display = "block";
            valid = false;
          }
          if (!/^[6-9]\d{9}$/.test(phone)) {
            el("#errPhone").style.display = "block";
            valid = false;
          }
          if (!addr) {
            el("#errAddress").style.display = "block";
            valid = false;
          }

          return valid;
        }

        // --- Events ---
        el("#search").addEventListener("input", renderGrid);
        el("#categoryFilter").addEventListener("change", renderGrid);

        el("#placeOrder").addEventListener("click", async (e) => {
          // 🆕 Added: disable + spinner
          const btn = e.currentTarget; // 🆕
          btn.disabled = true; // 🆕
          btn.classList.add("btn-loading"); // 🆕
          btn.textContent = "Placing Order..."; // 🆕

          if (Object.keys(Cart.items).length === 0) {
            toast("Add items first");
            // 🆕 re-enable button if failed
            btn.disabled = false; // 🆕
            btn.classList.remove("btn-loading"); // 🆕
            btn.textContent = "Place Order"; // 🆕
            return;
          }
          if (!validateCustomer()) {
            toast("Please fix errors");
            // 🆕 re-enable button if failed
            btn.disabled = false; // 🆕
            btn.classList.remove("btn-loading"); // 🆕
            btn.textContent = "Place Order"; // 🆕
            return;
          }

          try {
            // --- Collect customer details ---
            const name = el("#custName").value.trim();
            const phone = el("#custPhone").value.trim();
            const addr = el("#custAddress").value.trim();

            // Amount from Discount Total
            const amount = parseInt(
              el("#sumSale").textContent.replace(/[₹,]/g, ""),
              10
            );

            // Prepare items list
            const items = Object.entries(Cart.items).map(([id, qty]) => {
              const it = Catalog.list.find((x) => x.id == id);
              return { name: it?.name || "", qty, price: it?.sale || 0 };
            });

            // --- Download invoice ---
            await downloadOrderPdf();

            // --- Save to Firestore ---
            await saveOrderToFirebase(name, phone, addr, amount, items);

            // --- Show success ---
            // showSuccess("✅ Order placed successfully! Invoice downloaded.");
            showSuccessModal(
              "🎇 Order placed successfully! Invoice downloaded."
            ); //

            // --- Clear cart ---
            Cart.clear();
          } catch (err) {
            console.error("❌ Error in Place Order:", err);
            toast("Something went wrong while placing order.");
          } finally {
            // 🆕 Re-enable button after success/failure
            btn.disabled = false; // 🆕
            btn.classList.remove("btn-loading"); // 🆕
            btn.textContent = "Place Order"; // 🆕
          }
        });

        el("#clearCart").addEventListener("click", () => {
          Cart.clear();
          toast("Cart cleared");
        });
        if (el("#importCsv")) {
          el("#importCsv").addEventListener("click", () => {
            const txt = el("#csvInput").value;
            const items = parseCsv(txt);
            if (!items.length) return toast("Nothing to import");
            Catalog.list = [...Catalog.list, ...items];
            Catalog.save();
            renderFilters();
            renderGrid();
            toast("Imported");
          });
        }
        if (el("#exportCsv")) {
          el("#exportCsv").addEventListener("click", () => {
            download("abs_crackers_catalog.csv", toCsv(Catalog.list));
          });
        }

        // --- Init ---
        Catalog.load();
        Cart.load();
        renderFilters();
        renderGrid();
        renderCart();
        console.log("First item with image:1576", Catalog.list[0]);

        // expose for inline handlers
        window.addToCart = addToCart;
        window.Cart = Cart;
        window.chgQty = chgQty;
        window.scrollToCart = scrollToCart;

        // --- Extra helpers for CSV ---
        function parseCsv(text) {
          const lines = text.trim().split(/\r?\n/).filter(Boolean);
          if (!lines.length) return [];
          const out = [];
          const hasHeader = /name\s*,\s*category/i.test(lines[0]);
          const rows = hasHeader ? lines.slice(1) : lines;
          for (const ln of rows) {
            const cells = ln.split(",");
            if (cells.length < 5) continue;
            const [name, category, unit, mrp, sale] = cells.map((c) =>
              c.trim()
            );
            out.push({
              id: Date.now() + Math.random(),
              name,
              category,
              unit,
              mrp: +mrp,
              sale: +sale,
            });
          }
          return out;
        }
        function toCsv(items) {
          const header = "name,category,unit,mrp,sale";
          const rows = items.map((it) =>
            [it.name, it.category, it.unit, it.mrp, it.sale].join(",")
          );
          return [header, ...rows].join("\n");
        }
        function download(filename, content) {
          const blob = new Blob([content], { type: "text/plain" });
          const a = document.createElement("a");
          a.href = URL.createObjectURL(blob);
          a.download = filename;
          a.click();
          URL.revokeObjectURL(a.href);
        }
      });

      function addBadges() {
        const limitedProducts = [
          "STRAWBERRY FOUNTAIN",
          "ORANGE FOUNTAIN",
          "PINEAPPLE FOUNTAIN",
          "APPLE - MIX",
          "PUMPKIN FOUNTAIN",
          "BADA PEACOCK",
          "GUITAR",
          "HANUMAN KADA",

          // add more product names here
        ];
        const soldOutProducts = ["DRONE", "MEGA SIREN (3 PCS)"];

        const newProducts = [
          "STRAWBERRY FOUNTAIN",
          "ORANGE FOUNTAIN",
          "PINEAPPLE FOUNTAIN",
          "APPLE - MIX",
          "PUMPKIN FOUNTAIN",
          // add more new arrivals here
        ];

        // // replace limitedProducts = [...] with:
        // const limitedProducts = LIMITED_PRODUCTS;
        // // replace newProducts = [...] with:
        // const newProducts = NEW_PRODUCTS;

        // Limited Stock
        limitedProducts.forEach((name) => {
          const card = document.querySelector(`.card[aria-label="${name}"]`);
          if (card && !card.querySelector(".limited-badge")) {
            const imgBox = card.querySelector(".img-box");
            if (imgBox) {
              const badge = document.createElement("div");
              badge.className = "limited-badge";
              badge.textContent = "Limited Stock";
              imgBox.appendChild(badge);
            }
          }
        });

        // Sold Out
        soldOutProducts.forEach((name) => {
          const card = document.querySelector(`.card[aria-label="${name}"]`);
          if (card && !card.querySelector(".soldout-badge")) {
            const imgBox = card.querySelector(".img-box");
            if (imgBox) {
              const badge = document.createElement("div");
              badge.className = "soldout-badge";
              badge.textContent = "Sold Out";
              imgBox.appendChild(badge);
            }
            card.querySelectorAll(".btn.btn-primary").forEach((btn) => {
              btn.style.display = "none";
            });
          }
        });

        //  🆕 New Arrival
        newProducts.forEach((name) => {
          const card = document.querySelector(`.card[aria-label="${name}"]`);
          if (card && !card.querySelector(".new-badge")) {
            const imgBox = card.querySelector(".img-box");
            if (imgBox) {
              const badge = document.createElement("div");
              badge.className = "new-badge";
              badge.textContent = "NEW";
              imgBox.appendChild(badge);
            }
          }
        });
      }
    </script>
    <!-- 📱 Mobile Bottom Nav -->
    <div class="mobile-nav">
      <button id="navHome" onclick="window.scrollToTop()">
        <i class="icon">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="22"
            height="22"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path
              d="M3 9.5L12 3l9 6.5V21a1 1 0 0 1-1 1h-5v-7H9v7H4a1 1 0 0 1-1-1V9.5z"
            ></path>
          </svg>
        </i>
        <span>Home</span>
      </button>

      <!-- Filter -->
      <button id="navFilter" onclick="window.openFilter()">
        <i class="icon">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="22"
            height="22"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <polygon points="3 4 21 4 14 14 14 21 10 19 10 14 3 4"></polygon>
          </svg>
        </i>
        <span>Filter</span>
      </button>
      <button class="cart-btn" onclick="scrollToCart()">
        <!-- same cart icon with badge -->
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="22"
          height="22"
          viewBox="0 0 24 24"
          fill="none"
          stroke="white"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <circle cx="9" cy="21" r="1"></circle>
          <circle cx="20" cy="21" r="1"></circle>
          <path
            d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"
          ></path>
        </svg>
        <span id="cartCountBottom" class="badge-count">0</span>
        <br /><span>Cart</span>
      </button>
    </div>
    <!-- 📱 Side Drawer for Filters -->
    <div id="filterDrawer" class="drawer">
      <div class="drawer-content">
        <span class="drawer-close" onclick="closeFilterDrawer()">×</span>
        <h3>Filter by Category</h3>
        <ul id="drawerCategories"></ul>
        <!-- <button class="close-btn" onclick="closeFilterDrawer()">✖ Close</button> -->
      </div>
    </div>
  </body>
</html>

